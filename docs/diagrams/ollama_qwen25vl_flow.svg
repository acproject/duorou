<svg xmlns="http://www.w3.org/2000/svg" width="1080" height="640" viewBox="0 0 1080 640">
  <defs>
    <marker id="arrow" viewBox="0 0 10 10" refX="10" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#555" />
    </marker>
    <style>
      .box { fill: #f7f7fb; stroke: #6b6f76; stroke-width: 1.5; rx: 8; ry: 8; }
      .title { font: 700 14px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; fill: #222; }
      .desc { font: 12px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; fill: #444; }
      .groupTitle { font: 600 13px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; fill: #2b6cb0; }
      .arrow { stroke: #777; stroke-width: 1.5; fill: none; marker-end: url(#arrow); }
    </style>
  </defs>

  <!-- Row 1: Entry -->
  <rect class="box" x="30" y="40" width="200" height="72" />
  <text class="title" x="130" y="65" text-anchor="middle">客户端/调用方</text>
  <text class="desc" x="130" y="86" text-anchor="middle">generate(prompt, images?)</text>

  <line class="arrow" x1="230" y1="76" x2="310" y2="76" />

  <rect class="box" x="310" y="40" width="220" height="72" />
  <text class="title" x="420" y="65" text-anchor="middle">OllamaModelManager</text>
  <text class="desc" x="420" y="86" text-anchor="middle">注册/加载/卸载/路由</text>

  <line class="arrow" x1="530" y1="76" x2="610" y2="76" />

  <rect class="box" x="610" y="40" width="210" height="72" />
  <text class="title" x="715" y="65" text-anchor="middle">OllamaPathResolver</text>
  <text class="desc" x="715" y="86" text-anchor="middle">模型名→路径/manifest</text>

  <line class="arrow" x1="815" y1="76" x2="900" y2="76" />

  <rect class="box" x="900" y="40" width="150" height="72" />
  <text class="title" x="975" y="65" text-anchor="middle">GGUFParser</text>
  <text class="desc" x="975" y="86" text-anchor="middle">元数据/张量/架构</text>

  <!-- Row 2: Engine + Preprocess -->
  <line class="arrow" x1="420" y1="112" x2="420" y2="160" />

  <rect class="box" x="290" y="160" width="260" height="88" />
  <text class="title" x="420" y="185" text-anchor="middle">Qwen25VLInferenceEngine</text>
  <text class="desc" x="420" y="206" text-anchor="middle">加载权重/视觉模块/采样</text>

  <line class="arrow" x1="420" y1="248" x2="420" y2="290" />

  <rect class="box" x="260" y="290" width="320" height="100" />
  <text class="title" x="420" y="315" text-anchor="middle">预处理与分词</text>
  <text class="desc" x="420" y="336" text-anchor="middle">TextProcessor + Qwen2Preprocessor</text>
  <text class="desc" x="420" y="356" text-anchor="middle">SentencePiece/BPE + 特殊Token</text>

  <!-- Vision branch -->
  <line class="arrow" x1="580" y1="340" x2="700" y2="340" />
  <rect class="box" x="700" y="300" width="220" height="80" />
  <text class="title" x="810" y="325" text-anchor="middle">VisualEncoder（可选）</text>
  <text class="desc" x="810" y="346" text-anchor="middle">图像→特征/视觉Token</text>

  <!-- Row 3: Decode -->
  <line class="arrow" x1="420" y1="390" x2="420" y2="430" />
  <rect class="box" x="300" y="430" width="240" height="96" />
  <text class="title" x="420" y="456" text-anchor="middle">解码与采样循环</text>
  <text class="desc" x="420" y="477" text-anchor="middle">KV缓存/注意力/Logits/采样</text>

  <line class="arrow" x1="420" y1="526" x2="420" y2="566" />
  <rect class="box" x="300" y="566" width="240" height="56" />
  <text class="title" x="420" y="595" text-anchor="middle">detokenize → 输出</text>

  <!-- Group labels -->
  <text class="groupTitle" x="100" y="28">调用入口</text>
  <text class="groupTitle" x="715" y="28">路径/解析</text>
  <text class="groupTitle" x="420" y="148">推理引擎</text>
  <text class="groupTitle" x="420" y="278">预处理/分词</text>
  <text class="groupTitle" x="810" y="288">视觉支路</text>
  <text class="groupTitle" x="420" y="418">生成阶段</text>
</svg>